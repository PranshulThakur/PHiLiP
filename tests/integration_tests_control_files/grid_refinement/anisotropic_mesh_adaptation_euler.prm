# Listing of Parameters
# ---------------------
# Number of dimensions
set dimension = 2

# The PDE we want to solve. Choices are
# <advection|diffusion|convection_diffusion>.
set pde_type  = euler      
set test_type = anisotropic_mesh_adaptation

set conv_num_flux = roe

set diss_num_flux = symm_internal_penalty

#set overintegration = 10
#set output_face_results_vtk = true
#set sipg_penalty_factor = 20.0

subsection euler
  set reference_length = 1.0
  set mach_infinity = 1.5
  set angle_of_attack = 3.0
end

subsection artificial dissipation
  set add_artificial_dissipation = true
  set artificial_dissipation_type = laplacian
  set mu_artificial_dissipation = 0.1
  set kappa_artificial_dissipation = 5.0
end

subsection functional
  # functional choice
  set functional_type = lift
end

subsection linear solver
  subsection gmres options
    # Factor by which the diagonal of the matrix will be scaled, which
    # sometimes can help to get better preconditioners
    set ilut_atol                 = 1e-5
    # Amount of an absolute perturbation that will be added to the diagonal of
    # the matrix, which sometimes can help to get better preconditioners
    set ilut_rtol                 = 1.01
    # relative size of elements which should be dropped when forming an
    # incomplete lu decomposition with threshold
    set ilut_drop                 = 1.0e-8
    # Amount of additional fill-in elements besides the sparse matrix
    # structure
    set ilut_fill                 = 20
    # Linear residual tolerance for convergence of the linear system
    set linear_residual_tolerance = 1e-13
    # Maximum number of iterations for linear solver
    set max_iterations            = 2000
    # Number of iterations before restarting GMRES
    set restart_number            = 200
  end
end

subsection mesh adaptation
   set total_mesh_adaptation_cycles = 5
   set use_goal_oriented_mesh_adaptation = true
   set mesh_adaptation_type = h_adaptation
   subsection fixed-fraction
     set refine_fraction = 1.0
   end
end

subsection optimization
    set optimization_type = full_space
    set use_coarse_residual = false
    set use_fine_solution = false

    set gradient_tolerance = 1.0e-10 
    set max_design_cycles = 0 #200
    set linear_iteration_limit = 1000
    set initial_step_size = 1.0
    set functional_evaluation_limit = 30
    set line_search_method = Backtracking
    set line_search_curvature = Strong Wolfe Conditions
    set reduced_space_descent_method = Newton-Krylov
    set full_space_preconditioner = P2A
    set mesh_weight_factor = 0.1

    set regularization_parameter = 1.0
    set regularization_scaling = 2.0
    set regularization_tol_low = 1.0e-2
    set regularization_tol_high = 1.0e-1
end

subsection ODE solver
  #set output_solution_every_x_steps = 1
  set nonlinear_max_iterations            = 2000
  set nonlinear_steady_residual_tolerance = 1e-11
  set ode_solver_type  = implicit
  set initial_time_step = 1e3
#  set time_step_factor_residual = 15.0
#  set time_step_factor_residual_exp = 2
  set print_iteration_modulo              = 1
end

subsection flow_solver
  set flow_case_type = naca0012
  set poly_degree = 2
  set max_poly_degree_for_adaptation = 3
  set steady_state = true
  set steady_state_polynomial_ramping = true
  subsection grid
    #set grid_degree = 1
    set input_mesh_filename = ../../meshes/mesh_naca0012
    #set input_mesh_filename = ../../meshes/naca0012_hopw_ref0
  end
end
